
@{
    ViewBag.Title = "Index";
}

@Scripts.Render("~/Index/js")
<style>
    /*翻页*/

    .pagenation {
        padding: 40px 30px 60px 500px;
        color: #666;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

        .pagenation .pagenum {
            float: left;
            min-width: 30px;
            padding: 3px 5px;
            text-align: center;
            margin-right: 5px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 3px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

            .pagenation .pagenum.indexpage, .pagenation .pagenum.lastpage, .pagenation .pagenum.nextpage {
                background: rgba(255,255,255,0);
                color: #d9cfce;
            }

                .pagenation .pagenum.indexpage.active, .pagenation .pagenum.lastpage.active, .pagenation .pagenum.nextpage.active {
                    background-color: #f5f5f5;
                    color: #999;
                }

                    .pagenation .pagenum.indexpage.active a, .pagenation .pagenum.lastpage.active a, .pagenation .pagenum.nextpage.active a {
                        color: #999;
                    }

            .pagenation .pagenum.pagetext, .pagenation .pagenum.totalpage {
                border-radius: 0px;
                background: rgba(255,255,255,0);
                border: none;
            }

            .pagenation .pagenum a {
                color: #999;
                text-decoration: none;
                display: block;
                width: 100%;
                height: 100%;
            }

        .pagenation .pageswiperbox {
            min-width: 35px;
            max-width: 175px;
            overflow: hidden;
            word-break: keep-all;
            white-space: nowrap;
            text-overflow: ellipsis;
            float: left;
        }

        .pagenation .pageswiper {
            width: auto;
        }

            .pagenation .pageswiper .pagenum {
                display: inline-block;
                float: none;
            }

        .pagenation .pagenum.curpage {
            background: rgba(255,255,255,0);
            color: #FE7200;
            border: none;
        }

            .pagenation .pagenum.curpage a {
                color: #FE7200;
                display: block;
                width: 100%;
            }

        .pagenation .pageinput {
            text-align: center;
            border: 1px solid #e5e5e5;
            width: 40px;
            margin: 0 3px;
            line-height: 17px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .pagenation .pagesubbtn {
            background: rgba(255,255,255,0);
        }

            .pagenation .pagesubbtn a {
                color: #d9cfce;
            }

            .pagenation .pagesubbtn.active {
                background: #f5f5f5;
            }

            .pagenation .pagesubbtn a {
                color: #999;
            }  
</style>
<div style="height:100px;">

</div>
<div style="text-align: center;border-top:1px solid #000">
    帖题：<font style="text-align:center" size="20" color="red">@ViewBag.head</font>
</div>
<div style="text-align: center;border-top:1px solid #000">
    楼主：<font style="text-align:center" size="30">@ViewBag.txt</font>
</div>
<div id="pageBox">  
    @{

        List<WebApplication1.Models.Comment> cms = ViewData["data"] as List<WebApplication1.Models.Comment>;
        int len = cms.Count();
        int cout = 1;
        string datas = "";
        for (int i = 0; i < len; i++)
        {
            if (i == len - 1)
            {
                datas += "{txt:\"" + cms[i].txt + "\"," + "time:\"" + cms[i].time + "\"," + "name:\"" + cms[i].name + "\"," + "re1:\"" + cms[i].re1.ToString() + "\"," + "img:\"" + cms[i].img.ToString() + "\"," + "re2:\"" + cms[i].re2 + "\"}";
            }
            else
            {
                datas += "{txt:\"" + cms[i].txt + "\"," + "time:\"" + cms[i].time + "\"," + "name:\"" + cms[i].name + "\"," + "re1:\"" + cms[i].re1.ToString() + "\"," + "img:\"" + cms[i].img.ToString() + "\"," + "re2:\"" + cms[i].re2 + "\"},";
            }
        }
    }

</div>
<form id="form1" style="text-align: center;" method="post" onsubmit='return tijiao()' action='@Url.Content("~/AddComment/Index")'>
    发表评论：<input style="height:200px;width:80%;" type="text"  name="txt" placeholder="输入内容" />
    <input type="submit" value="提交"></input>
</form>
<script type="text/javascript">
    @Html.Raw("var table = ["+ @datas+"]");
    var len = @len;
    var tid =@ViewBag.tid;
    var num = 0;
    function ck(rep) {
        var s = $(rep)
        if ($("#form2").length > 0) {
            $("#form2").remove();
        }
        var ind = parseInt(rep.id);
        var ta = table[rep.id];
        if (ta["re2"] == "*") {

            s.parent().append("<form id=\"form2\" style=\"text-align: center;\" method=\"post\" action='/AddComment/Index'>回复  " + ta["name"]+" : "+"<input style=\"width:2000px;height:100px;\" type=\"text\" class=\"input_txt\" name=\"txt\" placeholder=\"输入内容\" /><input type='text' hidden name='tid' value='" + tid + "' /><input type='text' hidden name='rid' value='" + ta["re1"] + "' /><input type='text' hidden name='rid2' value='" + "-" + "' /><input type=\"submit\" class=\"btn btn-danger\" value='提交'></form>");
        }
        else
        {
            s.parent().append("<form id=\"form2\" style=\"text-align: center;\" method=\"post\" action='/AddComment/Index'>回复" + ta["name"] + " : " +"<input style=\"width:1000px;height:100px;\" type=\"text\" class=\"input_txt\" name=\"txt\" placeholder=\"输入内容\" /><input type='text' hidden name='tid' value='" + tid + "' /><input type='text' hidden name='rid' value='" + ta["re1"] + "' /><input type='text' hidden name='rid2' value='" + ta["name"] + "' /><input type=\"submit\" class=\"btn btn-danger\" value='提交'></form>");
        }


    }
    function tijiao() {
        var myform = $('#form1'); //得到form对象
        var title_id = $("<input type='text' hidden name='tid' value='" + tid + "'/>");
        var title_rid = $("<input type='text' hidden name='rid' value='" + "0" + "'/>");
        var title_rid2 = $("<input type='text' hidden name='rid2' value='" + "*" + "'/>");
        myform.append(title_id);
        myform.append(title_rid);
        myform.append(title_rid2);
        return true;
    }
    for (var i = 0; i < len; i++) {
        table[i]["index"] = i;
    }
    while (num<len&&num<10)
    {
        if (table[num]["re2"] == "*")
            $("#pageBox").append("<div class=\"list\" style=\"border-top:1px solid #000;\" ><div id=\"" + table[num]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:100px;text-align:center;font-size:25px;'>" + "<img style='width:100px;height:100px;' src='" + table[num]["img"] + "' />" + table[num]["name"] + "</div><div id=\"" + table[num]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:35px;\" onclick='ck(this)'>" + table[num]["txt"] + "</div><div style = \"position: relative;width:100px;top:-30px;font-size:20px;\" >" + table[num]["time"] + "</div></div>");
        else if (table[num]["re2"] == "-")
            $("#pageBox").append("<div class=\"list\" style=\"position: relative;left:150px;background-color:#FAEBD7;border-top:1px solid #000;\" ><div id=\"" + table[num]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:70px;text-align:center;font-size:20px;'>" + "<img style=\"width:100px;height:100px;\" src=\"" + table[num]["img"] + "\" />"+ table[num]["name"]+ "</div><div id=\"" + table[num]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:20px;\" onclick='ck(this)'>" + table[num]["txt"] + "</div><div style = \"position: relative;width:120px;top:-30px;font-size:16px;\" >" + table[num]["time"] + "</div></div>");
        else
            $("#pageBox").append("<div class=\"list\" style=\"position: relative;left:150px;background-color:#FAEBD7;border-top:1px solid #000;\" ><div id=\"" + table[num]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:70px;text-align:center;font-size:20px;'>" + "<img style='width:100px;height:100px;' src='" + table[num]["img"] + "'/>" + table[num]["name"] + " 回复  " + table[num]["re2"] + "</div><div id=\"" + table[num]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:20px;\" onclick='ck(this)'>" + table[num]["txt"] + "</div><div style = \"position: relative;width:120px;top:-30px;font-size:16px;\" >" + table[num]["time"] + "</div></div>");
        num++;
    }
    var options = {
        list: ".list",//列表标识
        currentPage: 1,//初始页（选传，默 认1）
        pageSize: 10,//每页列表数
        listTotal: len,//列表总数（选传），不传为list总数
        callback: function (currentPage) {//翻页回调（可填，可做ajax请求）,不传为纯html切换
            loadData(ajaxDemo(currentPage))
        }
    }

    $("#pageBox").paging(options)
    function ajaxDemo(page, pageSize) {
        if (!pageSize) var pageSize = 10;
        var data = [], arr = [];
        for (var i = 1; i <= len; i++) {
            arr.push(table[i - 1]);
             if (i < 10 && i ==@len)
            {
                data[1] = arr;
                arr = [];
            }
            @for(int i=1;i<=len/10;i++)
            {
                @Html.Raw("if(i=="+ i.ToString()+"*10){  data[" +i.ToString()+"] = arr; arr =[];}");
                if (i == len / 10)
                {
                    @Html.Raw("if(i==" + len.ToString() + "&&i!="+(i*10).ToString() + "){  data[" + (i+1).ToString() + "] = arr; arr =[];}");
                    }
            }



                    }
        return data[page];
    }
   function loadData(data) {
          console.log("callback")
              $("#pageBox").empty();
       for (var i = 0; i < data.length; i++) {
           if (data[i]["re2"] == "*")
               $("#pageBox").append("<div class=\"list\" style=\"\" ><div id=\"" + data[i]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:100px;text-align:center;font-size:25px;'>" + "<img style='width:100px;height:100px;' src='" + data[i]["img"] + "' />" + data[i]["name"] + "</div><div id=\"" + data[i]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:35px;\" onclick='ck(this)'>" + data[i]["txt"] + "</div><div style = \"position: relative;width:120px;top:-30px;font-size:20px;\" >" + data[i]["time"] + "</div></div>");
           else if (data[i]["re2"] == "-")
               $("#pageBox").append("<div class=\"list\" style=\"border-top:1px solid #000;position: relative;left:150px;background-color:#FAEBD7;\" ><div id=\"" + data[i]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:70px;text-align:center;font-size:20px;'>" + "<img style='width:100px;height:100px;' src='" + data[i]["img"]+"' />" + data[i]["name"] + "</div><div id=\"" + data[i]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:20x;\" onclick='ck(this)'>" + data[i]["txt"] + "</div><div style = \"position: relative;width:120px;top:-20px;font-size:16px;\" >" + data[i]["time"] + "</div></div>");
                  else
               $("#pageBox").append("<div class=\"list\" style=\"border-top:1px solid #000;position: relative;left:150px;background-color:#FAEBD7;\" ><div id=\"" + data[i]["index"].toString() + "\" onclick='ck(this)' style = 'position: relative; left: 5px; top: 5px;width:70px;text-align:center;font-size:20px;'>" + "<img style='width:100px;height:100px;' src='" + data[i]["img"] + "' />"+ data[i]["name"] + " 回复  " + data[i]["re2"] + "</div><div id=\"" + data[i]["index"].toString() + "\" style = \"position: relative; left: 105px; width:1000px;text-align:center;font-size:20px;\" onclick='ck(this)'>" + data[i]["txt"] + "</div><div style = \"position: relative;width:120px;top:-20px;font-size:16px;\" >" + data[i]["time"] + "</div></div>");
        }
    }

</script>
